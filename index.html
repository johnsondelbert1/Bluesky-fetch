<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shelbee's Hub</title>
    <style>
        /* Dark Theme and Material Design Styles */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212;
            color: #e0e0e0;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            background-color: #6200ea;
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .tab {
            flex: 1;
            text-align: center;
            color: white;
            padding: 10px;
            cursor: pointer;
        }

        .tab.active {
            background-color: #3700b3;
        }

        .tab-content {
            padding: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: #333;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card img {
            width: 100%;
            height: 200px;
            border-radius: 4px;
            object-fit: cover; /* Ensures the image covers the container while maintaining aspect ratio */
        }

        .card-header {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #fff;
        }

        .card-body {
            font-size: 1em;
            color: #ddd;
        }

        .subreddit {
            font-size: 0.9em;
            color: #b0b0b0;
        }

        .btn {
            background-color: #6200ea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 10px;
            background-color: #6200ea;
        }

        .footer .btn {
            background-color: #3700b3;
        }
    </style>
</head>
<body>

    <div class="tabs">
        <div class="tab active" id="redditTab">Reddit</div>
        <div class="tab" id="tumblrTab">Tumblr</div>
    </div>

    <div class="tab-content" id="redditContent">
        <h2>Reddit Posts</h2>
        <div id="redditPosts"></div>
    </div>

    <div class="tab-content" id="tumblrContent" style="display: none;">
        <h2>Tumblr Posts</h2>
        <div id="tumblrPosts"></div>
    </div>

    <div class="footer">
        <button class="btn" id="refreshButton">Refresh Data</button>
    </div>

    <script>
        const tumblrApiKey = 'ZGuu8GZuo6jmos0wHBgUG4zpfdzehIBSZvXECK3wU788LrjCcN';
        const redditUser = 'johnsondelbert1';
        const tumblrBlog = 'shelbeezz';
        
        const redditTab = document.getElementById('redditTab');
        const tumblrTab = document.getElementById('tumblrTab');
        const redditContent = document.getElementById('redditContent');
        const tumblrContent = document.getElementById('tumblrContent');
        const refreshButton = document.getElementById('refreshButton');
        
        // Switch tabs
        redditTab.addEventListener('click', () => {
            redditTab.classList.add('active');
            tumblrTab.classList.remove('active');
            redditContent.style.display = 'block';
            tumblrContent.style.display = 'none';
        });

        tumblrTab.addEventListener('click', () => {
            tumblrTab.classList.add('active');
            redditTab.classList.remove('active');
            tumblrContent.style.display = 'block';
            redditContent.style.display = 'none';
        });

        async function fetchRedditPosts() {
            const cachedData = localStorage.getItem('redditPosts');
            const cacheTimestamp = localStorage.getItem('redditCacheTimestamp');
            const now = Date.now();

            // If there is cached data and it is less than 24 hours old, use the cached data
            if (cachedData && now - cacheTimestamp < 24 * 60 * 60 * 1000) {
                displayPosts('reddit', JSON.parse(cachedData));
                return;
            }

            const url = `https://www.reddit.com/user/${redditUser}/submitted.json`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const posts = data.data.children.map(post => post.data);

                // Cache the posts and timestamp
                localStorage.setItem('redditPosts', JSON.stringify(posts));
                localStorage.setItem('redditCacheTimestamp', now.toString());

                displayPosts('reddit', posts); // Display the posts in the UI
            } catch (error) {
                console.error('Error fetching Reddit posts:', error);
            }
        }

        async function fetchTumblrPosts() {
            const cachedData = localStorage.getItem('tumblrPosts');
            const cacheTimestamp = localStorage.getItem('tumblrCacheTimestamp');
            const now = Date.now();

            // If there is cached data and it is less than 24 hours old, use the cached data
            if (cachedData && now - cacheTimestamp < 24 * 60 * 60 * 1000) {
                displayPosts('tumblr', JSON.parse(cachedData));
                return;
            }

            const url = `https://api.tumblr.com/v2/blog/${tumblrBlog}.tumblr.com/posts?api_key=${tumblrApiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                // Check if the request was successful
                if (data.meta.status === 200) {
                    // Cache the posts and timestamp
                    localStorage.setItem('tumblrPosts', JSON.stringify(data.response.posts));
                    localStorage.setItem('tumblrCacheTimestamp', now.toString());

                    displayPosts('tumblr', data.response.posts); // Display the posts in the UI
                } else {
                    console.error('Error fetching Tumblr posts:', data.meta);
                }
            } catch (error) {
                console.error('Error fetching Tumblr posts:', error);
            }
        }

        function displayPosts(platform, posts) {
            let postContainer = platform === 'reddit' ? document.getElementById('redditPosts') : document.getElementById('tumblrPosts');
            postContainer.innerHTML = ''; // Clear previous posts

            posts.forEach(post => {
                let card = document.createElement('div');
                card.classList.add('card');

                if (platform === 'reddit') {
                    // Reddit Post
                    const title = document.createElement('h3');
                    title.classList.add('card-header');
                    title.innerHTML = `<a href="${post.url}" target="_blank">${post.title}</a>`;

                    const subreddit = document.createElement('p');
                    subreddit.classList.add('subreddit');
                    subreddit.innerHTML = `Subreddit: /r/${post.subreddit}`;

                    const body = document.createElement('div');
                    body.classList.add('card-body');
                    body.innerHTML = post.selftext || "No description";

                    // Check if the Reddit post has an image
                    if (post.preview && post.preview.images && post.preview.images[0].source) {
                        const img = document.createElement('img');
                        img.src = post.preview.images[0].source.url;
                        card.appendChild(img);
                    }

                    card.appendChild(title);
                    card.appendChild(subreddit);
                    card.appendChild(body);
                } else if (platform === 'tumblr') {
                    // Tumblr Post
                    const title = document.createElement('h3');
                    title.classList.add('card-header');
                    title.innerHTML = post.summary || "No title";

                    const body = document.createElement('div');
                    body.classList.add('card-body');

                    // Check if it's a photo post
                    if (post.photos) {
                        post.photos.forEach(photo => {
                            const img = document.createElement('img');
                            img.src = photo.original_size.url;
                            // Apply object-fit cover to make the image fill the card
                            img.style.height = '200px'; 
                            img.style.objectFit = 'cover';
                            body.appendChild(img);
                        });
                    } else {
                        body.innerHTML += post.body || "No description";
                    }

                    card.appendChild(title);
                    card.appendChild(body);
                }

                postContainer.appendChild(card);
            });
        }

        // Refresh button event
        refreshButton.addEventListener('click', () => {
            fetchRedditPosts();
            fetchTumblrPosts();
        });

        // Initialize by fetching posts
        fetchRedditPosts();
        fetchTumblrPosts();
    </script>
</body>
</html>
